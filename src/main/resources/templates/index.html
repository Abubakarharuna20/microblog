<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="/assets/img/logo.png">
    <title>Microblog</title>
    <link href="/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <link href="/assets/vendor/slick/slick/slick.css" rel="stylesheet">
    <link href="/assets/vendor/slick/slick/slick-theme.css" rel="stylesheet">

    <link href="/assets/vendor/icofont/icofont.min.css" rel="stylesheet">

    <link href="/assets/vendor/icons/css/materialdesignicons.min.css" rel="stylesheet" type="text/css">

    <link href="/assets/css/style.css" rel="stylesheet">

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body class="bg-light">
<div class="theme-switch-wrapper ms-3">
    <label class="theme-switch" for="checkbox">
        <input type="checkbox" id="checkbox">
        <span class="slider round"></span>
        <i class="icofont-ui-brightness"></i>
    </label>
    <em>Enable Dark Mode!</em>
</div>
<div class="web-none d-flex align-items-center px-3 pt-3">
    <a href="index.html" class="text-decoration-none">
        <img src="/assets/img/logo.png" class="img-fluid logo-mobile" alt="brand-logo">
    </a>
    <button class="ms-auto btn btn-primary ln-0" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample" aria-controls="offcanvasExample">
        <span class="material-icons">menu</span>
    </button>
</div>
<div class="py-4">
    <div class="container">
        <div class="row position-relative">

            <main class="col col-xl-6 order-xl-2 col-lg-12 order-lg-1 col-md-12 col-sm-12 col-12">
                <div class="main-content">
                    <ul class="top-osahan-nav-tab nav nav-pills justify-content-center nav-justified mb-4 shadow-sm rounded-4 overflow-hidden bg-white sticky-sidebar2" id="pills-tab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="p-3 nav-link text-muted active" id="pills-feed-tab" data-bs-toggle="pill" data-bs-target="#pills-feed" type="button" role="tab" aria-controls="pills-feed" aria-selected="true">Feed</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="p-3 nav-link text-muted" id="pills-people-tab" data-bs-toggle="pill" data-bs-target="#pills-people" type="button" role="tab" aria-controls="pills-people" aria-selected="false">People</button>
                        </li>
                    </ul>
                    <div class="tab-content" id="pills-tabContent">
                        <div class="tab-pane fade show active" id="pills-feed" role="tabpanel" aria-labelledby="pills-feed-tab">

                            <div class="input-group mb-4 shadow-sm rounded-4 overflow-hidden py-2 bg-white" data-bs-toggle="modal" data-bs-target="#postModal">
                                <span class="input-group-text material-icons border-0 bg-white text-primary">account_circle</span>
                                <input type="text" class="form-control border-0 fw-light ps-1" placeholder="What's on your mind.">
                                <a href="#" class="text-decoration-none input-group-text bg-white border-0 material-icons text-primary">add_circle</a>
                            </div>

                            <div>
                                <div class="d-flex align-items-center justify-content-between mb-1">
                                    <h6 class="mb-0 fw-bold text-body">Follow People</h6>
<!--                                    <a href="#" class="text-dark text-decoration-none material-icons">east</a>-->
                                </div>

                                <div class="account-slider justify-content-start" id="userContainer">
                                </div>

                                <div class="pt-4 feeds" id="postsContainer">
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="pills-people" role="tabpanel" aria-labelledby="pills-people-tab">
                            <h6 class="mb-3 fw-bold text-body">People you can follow</h6>
                            <div class="bg-white rounded-4 overflow-hidden mb-4 shadow-sm"  id="peopleContainer">
                            </div>
                        </div>
                    </div>
                </div>
            </main>
            <aside class="col col-xl-3 order-xl-1 col-lg-6 order-lg-2 col-md-6 col-sm-6 col-12">
                <div class="p-2 bg-light offcanvas offcanvas-start" tabindex="-1" id="offcanvasExample">
                    <div class="sidebar-nav mb-3">
                        <div class="pb-4">
                            <a href="/" class="text-decoration-none">
                                <img src="/assets/img/logo.png" class="img-fluid logo" alt="brand-logo">
                            </a>
                        </div>
                        <ul class="navbar-nav justify-content-end flex-grow-1">
                            <li class="nav-item">
                                <a href="/" class="nav-link active"><span class="material-icons me-3">house</span> <span>Feed</span></a>
                            </li>
                            <li class="nav-item">
                                <a href="/edit-profile" class="nav-link"><span class="material-icons me-3">account_circle</span> <span>Profile</span></a>
                            </li>
                            <li class="nav-item logoutBtn">
                                <a href="#" class="nav-link"><span class="material-icons me-3">logout</span> <span>Logout</span></a>
                            </li>
                        </ul>
                    </div>
                    <!-- Card for user details -->
                    <div class="me-2 bg-white shadow-sm rounded-4 p-2 user-list-item d-flex flex-row gap-3 justify-content-center my-2 user-card card" style="display: none;">
                        <img class="user-avatar img-fluid rounded-circle user-img" width="30" src="#" alt="User Profile">
                        <div class="">
                            <h5 class="user-full-name card-text"></h5>
                            <p class="user-name card-title"></p>
                        </div>
                    </div>

                    <!-- Sign In button -->
                    <a href="/signup" class="sign-in-button btn btn-primary w-100 text-decoration-none rounded-4 py-3 fw-bold text-uppercase m-0">Sign In +</a>
                </div>

                <div class="ps-0 m-none fix-sidebar">
                    <div class="sidebar-nav mb-3">
                        <div class="pb-4 mb-4">
                            <a href="/" class="text-decoration-none">
                                <img src="/assets/img/logo.png" class="img-fluid logo" alt="brand-logo">
                            </a>
                        </div>
                        <ul class="navbar-nav justify-content-end flex-grow-1">
                            <li class="nav-item">
                                <a href="/" class="nav-link active"><span class="material-icons me-3">house</span> <span>Feed</span></a>
                            </li>
                            <li class="nav-item">
                                <a href="/edit-profile" class="nav-link"><span class="material-icons me-3">account_circle</span> <span>Profile</span></a>
                            </li>
                            <li class="nav-item logoutBtn">
                                <a href="#" class="nav-link"><span class="material-icons me-3">logout</span> <span>Logout</span></a>
                            </li>
                        </ul>
                    </div>
                    <!-- Card for user details -->
                    <div class="me-2 bg-white shadow-sm rounded-4 p-2 user-list-item d-flex flex-row gap-3 justify-content-center my-2 user-card card" style="display: none;">
                        <img class="user-avatar img-fluid rounded-circle user-img" width="30" src="#" alt="User Profile">
                        <div class="">
                            <h5 class="user-full-name card-text"></h5>
                            <p class="user-name card-title"></p>
                        </div>
                    </div>

                    <!-- Sign In button -->
                    <a href="/signup" class="sign-in-button btn btn-primary w-100 text-decoration-none rounded-4 py-3 fw-bold text-uppercase m-0">Sign In +</a>
                </div>
            </aside>
        </div>
    </div>
</div>
<div class="py-3 bg-white footer-copyright">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8">
                <span class="me-3 small">Â©2023 <b class="text-primary">Microblog</b>. All rights reserved</span>
            </div>
            <div class="col-md-4 text-end">
                <a target="_blank" href="#" class="btn social-btn btn-sm text-decoration-none"><i class="icofont-facebook"></i></a>
                <a target="_blank" href="#" class="btn social-btn btn-sm text-decoration-none"><i class="icofont-twitter"></i></a>
                <a target="_blank" href="#" class="btn social-btn btn-sm text-decoration-none"><i class="icofont-linkedin"></i></a>
                <a target="_blank" href="#" class="btn social-btn btn-sm text-decoration-none"><i class="icofont-youtube-play"></i></a>
                <a target="_blank" href="#" class="btn social-btn btn-sm text-decoration-none"><i class="icofont-instagram"></i></a>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="postModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content rounded-4 p-4 border-0 bg-light">
            <form id="addPostForm" enctype="multipart/form-data">
                <div class="modal-header d-flex align-items-center justify-content-start border-0 p-0 mb-3">
                    <a href="#" class="text-muted text-decoration-none material-icons" data-bs-dismiss="modal">arrow_back_ios_new</a>
                    <h5 class="modal-title text-muted ms-3 ln-0" id="staticBackdropLabel"><span class="material-icons md-32">account_circle</span></h5>
                </div>
                <div class="modal-body p-0 mb-3">
                    <div class="form-floating">
                        <textarea class="form-control rounded-5 border-0 shadow-sm" placeholder="Leave a comment here" id="content" name="content" style="height: 200px"></textarea>
                        <label for="content" class="h6 text-muted mb-0">What's on your mind...</label>
                    </div>
                </div>
                <div class="modal-footer justify-content-start px-1 py-1 bg-white shadow-sm rounded-5">
                    <div class="rounded-4 m-0 px-3 py-2 d-flex align-items-center justify-content-between w-75">
                        <button id="uploadButton" class="text-muted text-decoration-none material-icons">image</button>
                        <input type="file" id="fileInput" name="image" accept="image/*" style="display: none;">
                    </div>
                    <div class="ms-auto m-0">
                        <button type="submit" class="btn btn-primary rounded-5 fw-bold px-3 py-2 fs-6 mb-0 d-flex align-items-center"><span class="material-icons me-2 md-16">send</span>Post</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>



<script src="/assets/vendor/jquery/jquery.min.js" type="text/javascript"></script>
<script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js" type="text/javascript"></script>
<script src="/assets/js/custom.js" type="text/javascript"></script>
<script src="/assets/vendor/slick/slick/slick.min.js" type="text/javascript"></script>
<script>
    const userDetails = JSON.parse(localStorage.getItem('userDetails'));
    if (userDetails===null) {
        alert("logout Successfully");
        window.location.href = "/login";
    }else{
        var userId = userDetails.id;
    }
    document.addEventListener('DOMContentLoaded', function () {
        const fileInput = document.getElementById('fileInput');
        const uploadButton = document.getElementById('uploadButton');

        // Function to trigger file input click event
        function triggerFileInput() {
            fileInput.click();
        }

        // Add event listener to the upload button
        uploadButton.addEventListener('click', function (event) {
            event.preventDefault();
            triggerFileInput();
        });

        // Add event listener to the file input to handle file selection
        fileInput.addEventListener('change', function () {
            // Handle file selection here
            console.log('File selected:', fileInput.files[0]);
        });
    });

    document.addEventListener('DOMContentLoaded', function () {
        const userCards = document.querySelectorAll('.user-card');
        const signInButtons = document.querySelectorAll('.sign-in-button');

        // Function to check if user details exist in local storage
        function checkUserDetails() {
            const userDetails = JSON.parse(localStorage.getItem('userDetails'));
            if (userDetails) {
                // Loop through each user card
                userCards.forEach(function (userCard) {
                    // Display user card
                    userCard.style.display = 'block';
                    // Update user card with user details
                    const userAvatarElements = userCard.querySelectorAll('.user-avatar');
                    userAvatarElements.forEach(function (userAvatar) {
                        userAvatar.src = userDetails.photoImagePath;
                    });
                    const userNameElements = userCard.querySelectorAll('.user-name');
                    userNameElements.forEach(function (userName) {
                        userName.textContent = '@'+userDetails.username;
                    });
                    const userFullNameElements = userCard.querySelectorAll('.user-full-name');
                    userFullNameElements.forEach(function (userFullName) {
                        userFullName.textContent = userDetails.name;
                    });
                });
                // Loop through each sign-in button
                signInButtons.forEach(function (signInButton) {
                    // Hide Sign In button
                    signInButton.style.display = 'none';
                });
            } else {
                // Loop through each user card
                userCards.forEach(function (userCard) {
                    // Hide user card
                    userCard.style.display = 'none';
                });
                // Loop through each sign-in button
                signInButtons.forEach(function (signInButton) {
                    // Display Sign In button
                    signInButton.style.display = 'block';
                });
            }
        }

        // Call the function to check user details when the page loads
        checkUserDetails();
    });

    // GET List Of Posts
    // Function to fetch and display posts
    function fetchPost() {
        $.ajax({
            type: "GET",
            url: "http://localhost:8080/api/posts",
            success: function(posts) {
                const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
                posts.forEach(function(post) {
                    let month = months[new Date(post.createdAt).getMonth()];
                    let day = new Date(post.createdAt).getDate();
                    postDate = day+' '+month;
                    var postHtml = `
                        <div class="bg-white p-3 feed-item rounded-4 mb-3 shadow-sm">
                            <div class="d-flex">
                                <img src="${post.user.photoImagePath}" class="img-fluid rounded-circle user-img" alt="profile-img" />
                                <div class="d-flex ms-3 align-items-start w-100">
                                    <div class="w-100">
                                        <div class="d-flex align-items-center justify-content-between">
                                            <a href="/profile/@${post.user.username}" class="text-decoration-none d-flex align-items-center">
                                                <h6 class="fw-bold mb-0 text-body">${post.user.name}</h6>
                                                <span class="ms-2 material-icons bg-primary p-0 md-16 fw-bold text-white rounded-circle ov-icon">done</span>
                                                <small class="text-muted ms-2">@${post.user.username}</small>
                                            </a>
                                            <div class="d-flex align-items-center small">
                                                <p class="text-muted mb-0">${postDate}</p>
                                            </div>
                                        </div>
                                        <div class="my-2">
                                            <a href="/post/${post.id}" class="text-decoration-none">
                                                <p class="text-dark">${post.content}</p>
                                                ${post.image !== null ? `<img src="${post.imagePath}" class="img-fluid rounded mb-3">` : ''}
                                            </a>
                                            <div class="d-flex align-items-center justify-content-between mb-2">
                                                <div>
                                                    <div class="likeBtn small d-flex align-items-center text-muted text-decoration-none" data-post-id="${post.id}">
                                                        <span class="material-icons md-20 me-2">thumb_up_off_alt</span>
                                                        <span class="likeCount" data-post-id="${post.id}"></span>
                                                    </div>
                                                </div>
                                                <div>
                                                    <a href="#" class="text-muted text-decoration-none d-flex align-items-start fw-light">
                                                        <span class="material-icons md-20 me-2">chat_bubble_outline</span>
                                                        <span class="commentCount" data-post-id="${post.id}"></span>
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="mb-2">
                                                <div class="d-flex align-items-center">
                                                    <span class="material-icons bg-white border-0 text-primary pe-2 md-36">account_circle</span>
                                                    <form data-post-id="${post.id}" class="commentForm d-flex align-items-center w-100">
                                                        <input type="text" name="content" class="form-control form-control-sm rounded-3 fw-light" placeholder="Write Your comment">
                                                        <button class="bg-white border-0 text-primary ps-2 text-decoration-none">Post</button>
                                                    </form>
                                                </div>
                                            </div>
                                            <div class="comments" id="post-${post.id}-comments">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    $("#postsContainer").append(postHtml);
                    fetchCommentsForPost(post.id);
                    loadLikes(post.id);
                });
            },
            error: function(xhr, status, error) {
                console.error(xhr.responseText);
            }
        });
    }


    // Function to load likes for a post
    function loadLikes(postId) {
        $.ajax({
            type: "GET",
            url: `http://localhost:8080/api/likes/post/${postId}`, // Assuming this endpoint fetches likes for a specific post
            success: function(likes) {
                var likeCount = likes.length;
                $(`.likeCount[data-post-id="${postId}"]`).text(likeCount);

                // Check if the current user has liked this post
                var currentUserLiked = likes.some(function(like) {
                    return like.user.id === userId;
                });

                if (currentUserLiked) {
                    $(`.likeBtn[data-post-id="${postId}"]`).addClass('liked'); // Add a class to indicate that the post is liked
                    $(`.likeBtn[data-post-id="${postId}"] .material-icons`).text('thumb_up_alt').css('color', 'blue');
                }
            },
            error: function(xhr, status, error) {
                console.error(xhr.responseText);
            }
        });
    }

    // Function to handle toggling likes
    $(document).on('click', '.likeBtn', function() {
        var postId = $(this).data('post-id');
        var likeBtn = $(this);

        if (likeBtn.hasClass('liked')) {
            // User is unliking the post
            $.ajax({
                type: "DELETE",
                url: "http://localhost:8080/api/likes/unlike",
                data: {
                    postId: postId,
                    userId: userId
                },
                success: function(response) {
                    likeBtn.removeClass('liked');
                    var likeCountText = likeBtn.find('.likeCount').text().trim(); // Remove leading and trailing whitespace
                    var likeCount = parseInt(likeCountText); // Parse the integer
                    if (!isNaN(likeCount)) { // Check if parsing was successful
                        likeBtn.find('.likeCount').text(likeCount - 1); // Update the like count
                    } else {
                        console.error('Invalid like count:', likeCountText);
                    }

                    $(`.likeBtn[data-post-id="${postId}"] .material-icons`).text('thumb_up_off_alt');
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                }
            });
        } else {
            // User is liking the post
            $.ajax({
                type: "POST",
                url: "http://localhost:8080/api/likes/like",
                data: {
                    postId: postId,
                    userId: userId
                },
                success: function(response) {
                    likeBtn.addClass('liked');
                    var likeCountText = likeBtn.find('.likeCount').text().trim(); // Remove leading and trailing whitespace
                    var likeCount = parseInt(likeCountText); // Parse the integer
                    if (!isNaN(likeCount)) { // Check if parsing was successful
                        likeBtn.find('.likeCount').text(likeCount + 1); // Update the like count
                    } else {
                        console.error('Invalid like count:', likeCountText);
                    }

                    $(`.likeBtn[data-post-id="${postId}"] .material-icons`).text('thumb_up_alt').css('color', 'blue');
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                }
            });
        }
    });


    fetchPost();
    // Add Post
    $("#addPostForm").submit(function (event) {
        event.preventDefault();
        var formData = new FormData();
        formData.append("userId", userDetails.id);
        formData.append("content", $("#content").val());
        formData.append("image", $("#fileInput")[0].files[0]);
        $.ajax({
            type: "POST",
            url: "http://localhost:8080/api/posts/create",
            processData: false,
            contentType: false,
            data: formData,
            success: function (response) {
                console.log(response);
                alert(response);
                window.location.reload();
                fetchPost();
                // Handle successful post addition
            },
            error: function (xhr, status, error) {
                console.error(xhr.responseText);
                alert(xhr.responseText);
                // Handle post addition failure
            }
        });
    });

    // Fetch posts comment
    function fetchCommentsForPost(postId) {
        $.ajax({
            type: "GET",
            url: "http://localhost:8080/api/posts/" + postId + "/comment",
            success: function(comments) {
                $("#post-" + postId + "-comments").empty();
                var commentCount = comments.length;
                $(`.commentCount[data-post-id="${postId}"]`).text(commentCount);
                comments.forEach(function(comment) {
                    var commentHtml = `
                            <div class="d-flex mb-2">
                                <img src="${comment.user.photoImagePath}" class="img-fluid rounded-circle" alt="commenters-img"/>
                                <div class="ms-2 small">
                                    <div class="text-dark text-decoration-none">
                                        <div class="bg-light px-3 py-2 rounded-4 mb-1 chat-text">
                                            <a href="/profile/@${comment.user.username}" class="text-decoration-none text-dark"><p class="fw-500 mb-0">${comment.user.name}</p></a>
                                            <span class="text-muted">${comment.content}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        `;
                    $("#post-" + postId + "-comments").append(commentHtml);
                });
            },
            error: function(xhr, status, error) {
                console.error(xhr.responseText);
            }
        });
    }


    // Comment form submission handler
    $(document).on("submit", ".commentForm", function (event) {
        event.preventDefault();
        var postId = $(this).data("post-id");
        var content = $(this).find("input[name='content']").val();
        alert(postId + content);
        $.ajax({
            type: "POST",
            url: "http://localhost:8080/api/posts/" + postId + "/comment",
            processData: false,
            contentType: "application/json", // Set content type to JSON
            data: JSON.stringify({ // Convert data to JSON string
                content: content,
                userId: userId
            }),
            success: function (response) {
                console.log(response);
                var content = $(this).find("input[name='content']").val('');
                fetchCommentsForPost(postId);
            },
            error: function (xhr, status, error) {
                console.error(xhr.responseText);
                alert(xhr.responseText);
            }
        });
        // Implement AJAX call to add comment
    });

    // Follow people and fetch user
    // Handle logout
    $('.logoutBtn a').on('click', function(event) {
        event.preventDefault();
        // Clear user details from localStorage
        localStorage.removeItem('userDetails');
        // Redirect to the logout endpoint or homepage
        window.location.href = "/login"; // Change to your actual logout endpoint if necessary
    });


    $(document).ready(function() {
        // Function to fetch and display users
        let userId = userDetails.id;

        function fetchUsers() {
            $.ajax({
                type: 'GET',
                url: '/api/users', // Change this URL to your actual endpoint
                success: function(users) {
                    $('#userContainer').empty(); // Clear the container before appending new users
                    $('#peopleContainer').empty(); // Clear the container before appending new users

                    if (users.length === 0) {
                        // If no users are returned, display a message
                        $('#userContainer').append('<p class="text-muted">No users to display.</p>');
                        $('#peopleContainer').append('<p class="text-muted">No people to display.</p>');
                    } else {
                        users.forEach(function(user) {
                            // Skip the current user
                            if (user.id === userId) {
                                return;
                            }

                            // Check if the current user is following this user
                            var isFollowing = user.followers.some(follower => follower.followingId === user.id);

                            var followButton = isFollowing ? `
                        <button class="btn btn-primary btn-sm px-3 rounded-pill btn-unfollow"
                                data-follower-id="${userId}"
                                data-following-id="${user.id}">
                            Unfollow
                        </button>` :
                                `<button class="btn btn-outline-primary btn-sm px-3 rounded-pill btn-follow"
                                 data-follower-id="${userId}"
                                 data-following-id="${user.id}">
                            + Follow
                        </button>`;

                            var userHtml = `
                        <div class="account-item" style="width: 207px;">
                            <div class="me-2 bg-white shadow-sm rounded-4 p-3 user-list-item d-flex justify-content-center my-2">
                                <div class="text-center">
                                    <div class="position-relative d-flex justify-content-center">
                                        <a href="/profile/@${user.username}" class="text-decoration-none">
                                            <img src="${user.photoImagePath}" class="img-fluid rounded-circle mb-3" alt="profile-img">
                                            <div class="position-absolute">
                                                <span class="material-icons bg-primary small p-1 fw-bold text-white rounded-circle">done</span>
                                            </div>
                                        </a>
                                    </div>
                                    <p class="fw-bold text-dark m-0">${user.name}</p>
                                    <p class="small text-muted">@${user.username}</p>
                                    <div class="btn-group" role="group" aria-label="Basic checkbox toggle button group">
                                        ${followButton}
                                    </div>
                                </div>
                            </div>
                        </div>`;

                            var peopleHtml = `
                        <a href="/profile/@${user.username}" class="p-3 border-bottom d-flex text-dark text-decoration-none account-item pf-item">
                            <img src="${user.photoImagePath}" class="img-fluid rounded-circle me-3" alt="profile-img">
                            <div>
                                <p class="fw-bold mb-0 pe-3 d-flex align-items-center">${user.name} <span class="ms-2 material-icons bg-primary p-0 md-16 fw-bold text-white rounded-circle ov-icon">done</span></p>
                                <div class="text-muted fw-light">
                                    <p class="mb-1 small">@${user.username}</p>
                                </div>
                            </div>
                            <div class="ms-auto">
                                ${followButton}
                            </div>
                        </a>`;

                            $('#userContainer').append(userHtml);
                            $('#peopleContainer').append(peopleHtml);
                        });
                    }
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                }
            });
        }

        // Function to handle following a user
        $(document).on('click', '.btn-follow', function() {
            var followerId = $(this).data('follower-id');
            var followingId = $(this).data('following-id');
            var button = $(this);

            $.ajax({
                type: 'POST',
                url: '/api/follows/follow',
                data: {
                    followerId: followerId,
                    followingId: followingId
                },
                success: function(response) {
                    button.text('Unfollow');
                    button.removeClass('btn-outline-primary');
                    button.addClass('btn-primary');
                    button.removeClass('btn-follow');
                    button.addClass('btn-unfollow');
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                }
            });
        });

        // Function to handle unfollowing a user
        $(document).on('click', '.btn-unfollow', function() {
            var followerId = $(this).data('follower-id');
            var followingId = $(this).data('following-id');
            var button = $(this);

            $.ajax({
                type: 'DELETE',
                url: '/api/follows/unfollow',
                data: {
                    followerId: followerId,
                    followingId: followingId
                },
                success: function(response) {
                    button.text('+ Follow');
                    button.removeClass('btn-primary');
                    button.addClass('btn-outline-primary');
                    button.removeClass('btn-unfollow');
                    button.addClass('btn-follow');
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                }
            });
        });

        // Call the fetchUsers function to populate the user container initially
        fetchUsers();
    });


</script>
</body>
</html>
